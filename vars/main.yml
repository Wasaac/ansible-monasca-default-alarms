---
system_alarm_definitions:
  - name: "Host Status"
    description: "Alarms when the specified host is down or not reachable"
    severity: "HIGH"
    expression: "host_alive_status > 0"
  - name: "CPU Usage"
    description: "Alarms when CPU usage is high"
    severity: "MEDIUM"
    expression: "avg(cpu.idle_perc) < 10 times 3"
  - name: "Disk Inode Usage"
    description: "Alarms when disk inode usage is high"
    severity: "MEDIUM"
    expression: "disk.inode_used_perc > 90"
    match_by:
      - "hostname"
      - "device"
  - name: "Disk Usage"
    description: "Alarms when disk usage is high"
    severity: "MEDIUM"
    expression: "disk.space_used_perc > 90"
    match_by:
      - "hostname"
      - "device"
  - name: "Memory Usage"
    description: "Alarms when memory usage is high"
    severity: "MEDIUM"
    expression: "avg(mem.usable_perc) < 10 times 3"
  - name: "Network Errors"
    description: "Alarms when either incoming or outgoing network errors are high"
    severity: "MEDIUM"
    expression: "net.in_errors_sec > 5 or net.out_errors_sec > 5"

monasca_alarm_definitions:
  - name: "Kafka Consumer Lag"
    description: "Alarms when the specified consumer_group is not keeping up with the incoming messages"
    severity: "MEDIUM"
    expression: "avg(kafka.consumer_lag) > 1000 times 3"
    match_by:
      - "consumer_group"
      - "hostname"
  - name: "Monasca Agent Emit Time"
    description: "Alarms when the elapsed time that Monasca Agent takes to send metrics to Monasca API is high"
    expression: "avg(monasca.emit_time_sec) > 2 times 3"
  - name: "Monasca Agent Collection Time"
    description: "Alarms when the elapsed time the Monasca Agent takes to collect metrics is high"
    expression: "avg(monasca.collection_time_sec) > 5 times 3"
  - name: "ZooKeeper Latency"
    description: "Alarms when the ZooKeeper latency is high"
    expression: "avg(zookeeper.avg_latency_sec) > 1 times 3"

openstack_alarm_definitions:
  - name: "Instance CPU Usage"
    description: "Alarms when the CPU usage of the specified instance is high"
    expression: "avg(cpu.utilization_perc) > 90 times 3"
    match_by:
      - "resource_id"

misc_alarm_definitions:
  - name: "HTTP Status"
    description: "Alarms when the specified HTTP endpoint is down or not reachable"
    severity: "HIGH"
    expression: "http_status > 0"
    match_by:
      - "service"
      - "component"
      - "hostname"
      - "url"
  - name: "Process Check"
    description: "Alarms when the specified process is not running"
    severity: "HIGH"
    expression: "process.pid_count < 1"
    match_by:
      - "process_name"
      - "hostname"
  - name: "Kernel Crash Dumps"
    description: "Kernel crash dumps are available on disk"
    expression: "crash.dump_count > 1"
  - name: "RabbitMQ Queue Depth"
    description: "Alarms when the depth of the message queue is high"
    expression: "avg(rabbitmq.queue.messages) > 10 times 3"
    severity: "MEDIUM"
    match_by:
      - "queue"
      - "hostname"
  - name: "MySQL Slow Query Rate"
    description: "Alarms when the slow query rate is high"
    expression: "avg(mysql.performance.slow_queries) > 10 times 3"
  - name: "Apache Status"
    description: "Alarms on failure to reach the Apache status endpoint"
    expression: "apache.status > 0"
    severity: "HIGH"
  - name: "Apache Idle Worker Count"
    description: "Alarms when there are no idle workers in the Apache server"
    expression: "avg(apache.performance.idle_worker_count) < 1 times 3"
    severity: "MEDIUM"
  - name: "NTP Time Sync"
    description: "Alarms when the NTP time offset is high"
    expression: "ntp.offset > 5 or ntp.offset < -5"

ceph_alarm_definitions:
  - name: "Ceph Health Status Warn"
    description: "Alarms when the Ceph health status is WARN (1)"
    expression: "max(ceph_health_status) > 0 and max(ceph_health_status) <=1"
    severity: "MEDIUM"
  - name: "Ceph Health Status Error"
    description: "Alarms when the Ceph health status is ERROR (2)"
    expression: "max(ceph_health_status) > 1 and max(ceph_health_status) <=2"
    severity: "HIGH"
  - name: "Ceph Cluster Usage above 75 percent"
    description: "Alarms when a Ceph Cluster Usage is > 75%"
    expression: "avg(ceph_cluster_usage, 600) > 0.75 times 3"
    severity: "MEDIUM"

prometheus_haproxy_alarm_definitions:
  - name: "HAProxy Backend Status"
    description: "Alarms when the specified HAProxy endpoint is down or not reachable"
    severity: "HIGH"
    expression: "haproxy_server_downtime_seconds_total_rate > 0"
    match_by:
      - "backend"
      - "server"
  - name: "HAProxy Backend Response Time"
    description: "Alarms when the specified HAProxy endpoint is slow"
    severity: "MEDIUM"
    expression: "haproxy_backend_http_response_time_average_seconds > 1"
    match_by:
      - "backend"
      - "hostname"

prometheus_mysqld_alarm_definitions:
  - name: "MySQL Down"
    description: "Alarms when MySQL is down"
    severity: "HIGH"
    expression: "mysql_up < 1"

prometheus_openstack_alarm_definitions:
  - name: "Neutron Service Status"
    description: "Alarms when Neutron is down"
    severity: "HIGH"
    expression: "openstack_neutron_up < 1"
  - name: "Nova Service Status"
    description: "Alarms when Nova is down"
    severity: "HIGH"
    expression: "openstack_nova_up < 1"
  - name: "Cinder Service Status"
    description: "Alarms when Cinder is down"
    severity: "HIGH"
    expression: "openstack_cinder_up < 1"
  - name: "Neutron Agents Status"
    description: "Alarms when the specified Neutron agent is down"
    severity: "HIGH"
    expression: "openstack_neutron_agent_state_total{adminState=enabled} < 0"
    match_by:
      - "hostname"
      - "service"
  - name: "Nova Agents Status"
    description: "Alarms when the specified Nova agent is down"
    severity: "HIGH"
    expression: "openstack_nova_agent_state_total{adminState=enabled} < 0"
    match_by:
      - "hostname"
      - "service"
  - name: "Cinder Agents Status"
    description: "Alarms when the specified Cinder agent is down"
    severity: "HIGH"
    expression: "openstack_cinder_agent_state_total{adminState=enabled} < 0"
    match_by:
      - "hostname"
      - "service"
